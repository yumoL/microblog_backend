(this.webpackJsonpmicroblog_frontend=this.webpackJsonpmicroblog_frontend||[]).push([[0],{263:function(e,t,n){e.exports=n(453)},272:function(e,t,n){},453:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(50),o=n.n(c),u=n(19),i=n(21),l=n(60),s=(n(272),n(8)),m=n.n(s),p=n(15),f=n(472),d=n(473),g=n(465),b=n(471),E=n(469),v=n(468),h=n(28),w=function(e,t){var n=Object(r.useState)(t||""),a=Object(h.a)(n,2),c=a[0],o=a[1];return{type:e,value:c,onChange:function(e){o(e.target.value)},clear:function(){o("")}}},O=n(38),x=n(36),y=n.n(x),j=null,N=function(){return{headers:{Authorization:j}}},k={uploadFile:function(){var e=Object(p.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.post("".concat("/api/utils","/upload"),t,N());case 2:return n=e.sent,console.log("return",n.data),e.abrupt("return",n.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),setToken:function(e){j="bearer ".concat(e)},destroyToken:function(){j=null}},I=function(){var e=Object(p.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.post("".concat("/api/user","/isExist"),{userName:t});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=Object(p.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.get("".concat("/api/user","/").concat(t),N());case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U={checkUserNameExisted:I,register:function(){var e=Object(p.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.post("".concat("/api/user","/register"),t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),login:function(){var e=Object(p.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.post("".concat("/api/user","/login"),t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),changeBasicInfo:function(){var e=Object(p.a)(m.a.mark((function e(t,n){var r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.patch("".concat("/api/user","/changeInfo/").concat(t),n,N());case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),changePwd:function(){var e=Object(p.a)(m.a.mark((function e(t,n){var r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.patch("".concat("/api/user","/changePwd/").concat(t),n,N());case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),getUserInfo:S};function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){Object(O.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var A="loggedInUser",R={userNameExisted:!1},C=function(e){window.localStorage.setItem(A,JSON.stringify(e)),k.setToken(e.token)},P=function(e){return function(){var t=Object(p.a)(m.a.mark((function t(n){var r,a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,U.checkUserNameExisted(e);case 2:r=t.sent,a=!!r.data,n({type:"USERNAME_EXISTED",userNameExisted:a});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},T=function(){return function(){var e=Object(p.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:k.destroyToken(),window.localStorage.removeItem(A),t({type:"CLEAR_USER"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"REGISTER":return R;case"USERNAME_EXISTED":return B({},e,{userNameExisted:t.userNameExisted});case"SET_USER":return t.loggedInUser;case"CLEAR_USER":return R;case"UPDATE_USER_INFO":return t.updatedUser;default:return e}},F=function(e){var t=e.message,n=e.error,r=void 0!==n&&n,a=e.timeout,c=void 0===a?5e3:a,o={message:t,error:r};return function(){var e=Object(p.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t({type:"SET_NOTIFICATION",content:o}),setTimeout((function(){t({type:"CLEAR_NOTIFICATION"})}),c);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},D=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_NOTIFICATION":return t.content;case"CLEAR_NOTIFICATION":return{};default:return e}},M={login:function(e){return function(){var t=Object(p.a)(m.a.mark((function t(n){var r,a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,U.login(e);case 2:r=t.sent,a=r.data,C(a),n({type:"SET_USER",loggedInUser:a});case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},setNotification:F},G=Object(l.g)(Object(u.b)((function(e){return{user:e.user}}),M)((function(e){var t=w("text"),n=w("password"),r=0===t.value.length||0===n.value.length,c=function(){var r=Object(p.a)(m.a.mark((function r(a){var c;return m.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a.preventDefault(),c={userName:t.value,password:n.value},r.prev=2,r.next=5,e.login(c);case 5:r.next=10;break;case 7:r.prev=7,r.t0=r.catch(2),e.setNotification({message:"Login failed, wrong username or password",error:!0});case 10:case"end":return r.stop()}}),r,null,[[2,7]])})));return function(e){return r.apply(this,arguments)}}(),o=(e.location.state||{from:{pathname:"/home"}}).from;return e.user.token?(e.setNotification({message:"You have logged in",error:!1}),a.a.createElement("div",{className:"redirect"},a.a.createElement(l.a,{to:o}))):a.a.createElement("div",null,a.a.createElement(f.a,{textAlign:"center",style:{height:"100vh"},verticalAlign:"middle"},a.a.createElement(f.a.Column,{style:{maxWidth:450}},a.a.createElement(d.a,{id:"loginHeader",as:"h2",color:"teal",textAlign:"center"},"Log in to your account"),a.a.createElement(g.a,{size:"large",onSubmit:c},a.a.createElement(b.a,{stacked:!0},a.a.createElement(g.a.Input,Object.assign({id:"userName",fluid:!0,icon:"user",iconPosition:"left",placeholder:"User Name"},t,{required:!0})),a.a.createElement(g.a.Input,Object.assign({id:"pwd",fluid:!0,icon:"lock",placeholder:"Password"},n,{required:!0})),a.a.createElement(E.a,{id:"loginButton",type:"submit",color:"teal",fluid:!0,size:"large",disabled:r},"Login"))),a.a.createElement(v.a,null,"New to us? ",a.a.createElement(i.b,{to:"/register"},"Sign Up")))))}))),z=function(e,t){var n=Object(r.useState)(e),a=Object(h.a)(n,2),c=a[0],o=a[1];return Object(r.useEffect)((function(){var n=setTimeout((function(){o(e)}),t);return function(){clearTimeout(n)}}),[e,t]),c},q=function(e){var t=e.fieldName,n=e.input,r=e.minLength,c=e.maxLength,o=e.extraRequirement,u=e.extraErrorMessage;return n?r&&c&&(n.length<r||n.length>c)?a.a.createElement("p",{style:{color:"red"}},t," should be between ",r," and ",c," characters"):!1===o?a.a.createElement("p",{style:{color:"red"}},u):a.a.createElement("p",{style:{color:"green"}},"Valid ",t):null},Y=function(){return a.a.createElement("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%,-50%)"}},a.a.createElement("h3",null,"You have already logged in, please go to the",a.a.createElement(i.b,{to:"/home"}," main page")," directly"))},J={checkUserNameExisted:P,register:function(e){return function(){var t=Object(p.a)(m.a.mark((function t(n){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,U.register(e);case 2:n({type:"REGISTER"});case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},setNotification:F},W=Object(l.g)(Object(u.b)((function(e){return{user:e.user,file:e.file}}),J)((function(e){var t=Object(r.useState)(!1),n=Object(h.a)(t,2),c=n[0],o=n[1],u=w("text"),s=w("password"),O=w("password"),x=z(u.value,500);Object(r.useEffect)((function(){x&&function(){var t=Object(p.a)(m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.checkUserNameExisted(x);case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()()}),[x]);var y=e.user.userNameExisted||u.value.length<3||u.value.length>255||s.value.length<3||s.value.length>255||s.value!==O.value,j=function(){var t=Object(p.a)(m.a.mark((function t(n){var r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),r={userName:u.value,password:O.value},t.prev=2,t.next=5,e.register(r);case 5:o(!0),e.setNotification({message:"Register succeeded, please log in",error:!1}),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),e.setNotification({message:"Register failed",error:!0});case 12:case"end":return t.stop()}}),t,null,[[2,9]])})));return function(e){return t.apply(this,arguments)}}();return c?a.a.createElement("div",{className:"redirect"},a.a.createElement(l.a,{to:"/login"})):e.user.token?a.a.createElement(Y,null):a.a.createElement("div",null,a.a.createElement(f.a,{textAlign:"center",style:{height:"100vh"},verticalAlign:"middle"},a.a.createElement(f.a.Column,{style:{maxWidth:450}},a.a.createElement(d.a,{id:"signUp",as:"h2",color:"teal",textAlign:"center"},"Sign Up"),a.a.createElement(g.a,{size:"large",onSubmit:j},a.a.createElement(b.a,{stacked:!0},a.a.createElement(g.a.Input,Object.assign({id:"userName",fluid:!0,icon:"user",iconPosition:"left",placeholder:"Username (between 3 and 255 characters)"},u,{required:!0})),a.a.createElement(q,{fieldName:"Username",input:u.value,minLength:3,maxLength:255,extraRequirement:!e.user.userNameExisted,extraErrorMessage:"User name is already existed"}),a.a.createElement(g.a.Input,Object.assign({id:"pwd",fluid:!0,icon:"lock",iconPosition:"left",placeholder:"Password (between 3 and 255 characters)"},s,{required:!0})),a.a.createElement(q,{fieldName:"Password",input:s.value,minLength:3,maxLength:255}),a.a.createElement(g.a.Input,Object.assign({id:"pwdConfirm",fluid:!0,placeholder:"Confirm Your Password"},O,{required:!0})),a.a.createElement(q,{fieldName:"Password confirmation",input:O.value,extraRequirement:s.value===O.value,extraErrorMessage:"Confirmation does not match the password"}),a.a.createElement(E.a,{id:"register",color:"teal",fluid:!0,size:"large",disabled:y},"Sign Up"))),a.a.createElement(v.a,null,"Already have an account? ",a.a.createElement(i.b,{to:"/login"},"Back to login")))))}))),H=n(475),X=Object(u.b)((function(e){return{notification:e.notification}}))((function(e){var t=e.notification,n=t.message,r=t.error;return n?a.a.createElement(H.a,{visible:!!n,animation:"fly down",duration:250},a.a.createElement("div",{style:{position:"fixed !important",top:"32px",right:"0",left:"0",textAlign:"center",zIndex:"10000"}},r?a.a.createElement(v.a,{floating:!0,color:"red",size:"large"},n):a.a.createElement(v.a,{floating:!0,color:"green",size:"large"},n))):null})),V=n(159),K=n(462),Q=n(81),Z=n(464),$=n(255),ee=function(e){var t=e.image,n=e.toUpload,r=e.removeImage;return t?a.a.createElement("div",{id:"image"},a.a.createElement(Z.a,{key:t,trigger:a.a.createElement($.a,{src:t,size:"medium"})},a.a.createElement(Z.a.Content,{image:!0},a.a.createElement($.a,{wrapped:!0,src:t}))),n&&a.a.createElement(Q.a,{name:"delete",onClick:r})):null},te=function(e){var t=Object(r.useState)([]),n=Object(h.a)(t,2),c=n[0],o=n[1],u=Object(r.useState)([]),i=Object(h.a)(u,2),l=i[0],s=i[1],d=w("text"),b=Object(r.useState)(0),v=Object(h.a)(b,2),O=v[0],x=v[1],y=function(){var t=Object(p.a)(m.a.mark((function t(n){var r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),r=null,c.length>0&&(r=new FormData,c.map((function(e){return r.append("file",e.fileContent)}))),t.next=5,e.createBlog(e.userId,d.value,r);case 5:o([]),s([]),x(0),d.clear(),e.setNotification({message:"You created a blog",error:!1});case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),j=a.a.createRef();return a.a.createElement("div",null,a.a.createElement(g.a,{onSubmit:y},a.a.createElement(g.a.Field,null,a.a.createElement(K.a,Object.assign({id:"blogTextField",placeholder:"new blog..."},d,{style:{minHeight:100},clear:"clear"})),a.a.createElement(E.a,{id:"insertImageButton",type:"button",onClick:function(){j.current.click()}},a.a.createElement(Q.a,{name:"picture"}),"insert an image (max 3)"),a.a.createElement("input",{id:"fileInput",type:"file",accept:"image/*",ref:j,onChange:function(t){if(3!==c.length){x(O+1);var n={fileContent:t.target.files[0],id:O},r={urlContent:URL.createObjectURL(n.fileContent),id:O};o([].concat(Object(V.a)(c),[n])),s([].concat(Object(V.a)(l),[r]))}else e.setNotification({message:"You can upload max 3 images",error:!0})},style:{display:"none"}})),c.length>0&&a.a.createElement(f.a,{style:{height:"33%",width:"33%"}},a.a.createElement(f.a.Row,{columns:3},l.map((function(e){return a.a.createElement(f.a.Column,{key:e.id},a.a.createElement(ee,{image:e.urlContent,toUpload:!0,removeImage:function(){return function(e){o(c.filter((function(t){return t.id!==e}))),s(l.filter((function(t){return t.id!==e})))}(l.find((function(t){return t.urlContent===e.urlContent})).id)}}))})))),a.a.createElement(E.a,{id:"publishBlogButton",color:"green"},"Publish your microblog")))},ne={createBlog:function(){var e=Object(p.a)(m.a.mark((function e(t,n){var r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.post("".concat("/api/blog","/create/").concat(t),n,N());case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),getBlogsByUser:function(){var e=Object(p.a)(m.a.mark((function e(t){var n,r,a=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:0,e.next=3,y.a.get("".concat("/api/blog","/profile/").concat(t,"/").concat(n),N());case 3:return r=e.sent,e.abrupt("return",r.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getAllBlogs:function(){var e=Object(p.a)(m.a.mark((function e(){var t,n,r=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:0,e.next=3,y.a.get("".concat("/api/blog","/discover/").concat(t),N());case 3:return n=e.sent,e.abrupt("return",n.data);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()};function re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?re(Object(n),!0).forEach((function(t){Object(O.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):re(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ce={allNumber:0,blogList:[]},oe=function(){return function(e){e({type:"CLEAR_BLOG_LIST"})}},ue=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ce,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CREATE_BLOG":return e;case"GET_BLOGS_BY_USER":case"GET_ALL_BLOGS":return ae({},e,{allNumber:t.allNumber,blogList:e.blogList.concat(t.blogList)});case"CLEAR_USER":case"CLEAR_BLOG_LIST":return ce;default:return e}},ie={createBlog:function(e,t,n){return function(){var r=Object(p.a)(m.a.mark((function r(a){var c,o,u,i,l;return m.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(c={content:t},null===n){r.next=7;break}return r.next=4,k.uploadFile(n);case 4:o=r.sent,u=o.data,c=ae({},c,{urls:u});case 7:return r.next=9,ne.createBlog(e,c);case 9:i=r.sent,l=i.data,a({type:"CREATE_BLOG",publishedBlog:l});case 12:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()},setNotification:F},le=Object(u.b)((function(e){return{user:e.user,blog:e.blog}}),ie)((function(e){return a.a.createElement("div",null,a.a.createElement(te,{userId:e.user.id,createBlog:e.createBlog,setNotification:e.setNotification}))})),se=n(250),me=Object(l.g)(Object(u.b)((function(e){return{user:e.user}}))((function(e){var t=!!e.user.token,n=e.component,r=Object(se.a)(e,["component"]);return a.a.createElement(l.b,Object.assign({},r,{render:function(e){return t?a.a.createElement(n,e):a.a.createElement(l.a,{to:{pathname:"/login",state:{from:e.location}}})}}))}))),pe=function(){return a.a.createElement("div",null,"The page cannot be found...")},fe=n(470),de=n(467),ge={logout:T},be=Object(l.g)(Object(u.b)((function(e){return{user:e.user}}),ge)((function(e){var t="/login"==e.location.pathname,n="/register"==e.location.pathname,r="/home"==e.location.pathname,c=e.location.pathname.includes("/profile"),o="/discover"==e.location.pathname;return e.user.token?a.a.createElement(fe.a,{tabular:!0},a.a.createElement(fe.a.Item,{id:"homeMenu",name:"Home",active:r,as:i.b,to:"/home"}),a.a.createElement(fe.a.Item,{id:"profileMenu",name:"Profile",active:c,as:i.b,to:"/profile/".concat(e.user.id,"/0")}),a.a.createElement(fe.a.Item,{id:"discoverMenu",name:"Discover",active:o,as:i.b,to:"/discover"}),a.a.createElement(fe.a.Menu,{position:"right"},a.a.createElement(de.a,{id:"settingDropdown",item:!0,text:"Setting"},a.a.createElement(de.a.Menu,null,a.a.createElement(de.a.Item,{id:"accountSettingItem",as:i.b,to:"/setting"},"Account setting"),a.a.createElement(de.a.Item,null,a.a.createElement(E.a,{id:"logoutButton",onClick:e.logout},a.a.createElement(i.b,{to:"/login"},"Logout"))))))):a.a.createElement(fe.a,{tabular:!0},a.a.createElement(fe.a.Item,{id:"loginMenu",name:"Login",active:t,as:i.b,to:"/login"}),a.a.createElement(fe.a.Item,{id:"registerMenu",name:"Register",active:n,as:i.b,to:"/register"}))}))),Ee={checkUserNameExisted:P,changeBasicInfo:function(e,t,n){return function(){var r=Object(p.a)(m.a.mark((function r(a){var c,o,u,i,l;return m.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(c={newUserName:t},null===n){r.next=8;break}return r.next=4,k.uploadFile(n);case 4:o=r.sent,u=o.data[0],console.log("suc model",o.data[0]),c=B({},c,{newPicture:u});case 8:return r.next=10,U.changeBasicInfo(e,c);case 10:i=r.sent,l=i.data,C(l),a({type:"UPDATE_USER_INFO",updatedUser:l});case 14:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()},changePwd:function(e,t,n){return function(){var r=Object(p.a)(m.a.mark((function r(a){var c,o,u;return m.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return c={pwd:t,newPwd:n},r.next=3,U.changePwd(e,c);case 3:o=r.sent,u=o.data,C(u),a({type:"UPDATE_USER_INFO",updatedUser:u});case 7:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()},setNotification:F},ve=Object(u.b)((function(e){return{user:e.user}}),Ee)((function(e){var t=w("text",e.user.userName),n=z(t.value,500),c=w("password"),o=w("password"),u=w("password"),i=Object(r.useState)(null),l=Object(h.a)(i,2),s=l[0],b=l[1],v=Object(r.useState)(""),O=Object(h.a)(v,2),x=O[0],y=O[1];Object(r.useEffect)((function(){n&&function(){var t=Object(p.a)(m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.checkUserNameExisted(n);case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()()}),[n]);var j=function(){var n=Object(p.a)(m.a.mark((function n(r){var a;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r.preventDefault(),a=null,null!==s&&(a=new FormData).append("file",s),n.prev=3,n.next=6,e.changeBasicInfo(e.user.id,t.value,a);case 6:e.setNotification({message:"You have changed your basic information",error:!1}),n.next=12;break;case 9:n.prev=9,n.t0=n.catch(3),e.setNotification({message:"Fail to change basic information",error:!0});case 12:case"end":return n.stop()}}),n,null,[[3,9]])})));return function(e){return n.apply(this,arguments)}}(),N=function(){var t=Object(p.a)(m.a.mark((function t(n){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),t.prev=1,t.next=4,e.changePwd(e.user.id,c.value,o.value);case 4:e.setNotification({message:"You have changed your password",error:!1}),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),e.setNotification({message:"Fail to change password, please make sure that your old password is correct",error:!0});case 10:c.clear(),o.clear(),u.clear();case 13:case"end":return t.stop()}}),t,null,[[1,7]])})));return function(e){return t.apply(this,arguments)}}(),k=e.user.userNameExisted&&t.value!==e.user.userName||t.value.length<3||t.value.length>255,I=o.value.length<3||o.value.length>255||o.value!==u.value;return a.a.createElement(f.a,{textAlign:"center",style:{height:"100vh"},verticalAlign:"middle"},a.a.createElement(f.a.Column,{style:{maxWidth:450}},a.a.createElement(d.a,{as:"h2",color:"teal",textAlign:"center"},"Account Setting"),a.a.createElement(d.a,{as:"h3",color:"teal",textAlign:"center"},"Basic information"),a.a.createElement(g.a,{onSubmit:j},a.a.createElement(g.a.Field,null,a.a.createElement("label",null,"User name"),a.a.createElement("input",Object.assign({id:"newUserNameField"},t,{clear:"clear"})),a.a.createElement(q,{fieldName:"Username",input:t.value,minLength:3,maxLength:255,extraRequirement:!e.user.userNameExisted||t.value===e.user.userName,extraErrorMessage:"User name is already existed"})),a.a.createElement(g.a.Field,null,a.a.createElement("label",null,"Change head portrait"),a.a.createElement(g.a.Input,{type:"file",accept:"image/*",onChange:function(e){var t=e.target.files[0];b(t),y(URL.createObjectURL(t))}}),a.a.createElement($.a,{src:""!==x?x:e.user.picture,size:"small"})),a.a.createElement(E.a,{id:"saveBIChangeButton",color:"teal",fluid:!0,size:"large",disabled:k},"Save basic information changes")),a.a.createElement(d.a,{as:"h3",color:"teal",textAlign:"center"},"Password"),a.a.createElement(g.a,{onSubmit:N},a.a.createElement(g.a.Field,null,a.a.createElement("label",null,"Current password"),a.a.createElement("input",Object.assign({id:"oldPwdField",placeholder:"current password"},c,{clear:"clear"}))),a.a.createElement(g.a.Field,null,a.a.createElement("label",null,"New password"),a.a.createElement("input",Object.assign({id:"newPwdField",placeholder:"new password"},o,{clear:"clear"})),a.a.createElement(q,{fieldName:"Password",input:o.value,minLength:3,maxLength:255})),a.a.createElement(g.a.Field,null,a.a.createElement("label",null,"Confirm new password"),a.a.createElement("input",Object.assign({id:"pwdConfirmField",placeholder:"new password confirmation"},u,{clear:"clear"}))),a.a.createElement(q,{fieldName:"Password confirmation",input:u.value,extraRequirement:o.value===u.value,extraErrorMessage:"Confirmation does not match the password"}),a.a.createElement(E.a,{id:"pwdSaveButton",color:"teal",fluid:!0,size:"large",disabled:I},"Save new password"))))})),he=n(463),we={},Oe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:we,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_USER_INFO":return t.checkedUser;default:return e}},xe=n(466),ye=function(e){return a.a.createElement("div",null,a.a.createElement(f.a,null,a.a.createElement(f.a.Row,{columns:3},e.images.map((function(e){return a.a.createElement(f.a.Column,{key:e},a.a.createElement(ee,{image:e}))})))))},je=function(e){var t=e.blog,n=t.images.map((function(e){return e.url}));return a.a.createElement(a.a.Fragment,null,a.a.createElement(xe.a,null,a.a.createElement(xe.a.Avatar,{src:t.user.picture,style:{marginGight:"0px"}}),a.a.createElement(xe.a.Author,null,a.a.createElement(i.b,{to:"/profile/".concat(t.userId,"/0")},t.user.userName)),a.a.createElement(xe.a.Content,null,a.a.createElement(xe.a.Metadata,null,a.a.createElement("div",null,t.createdAt)),a.a.createElement(xe.a.Text,null,t.content,a.a.createElement(ye,{images:n})))))},Ne=function(e){return a.a.createElement("div",null,a.a.createElement(xe.a.Group,null,e.blogList.map((function(e){return a.a.createElement("div",{key:e.id},a.a.createElement(je,{blog:e}))}))))},ke=function(e){var t=e.userId,n=e.getBlogsByUser,c=e.noMore,o=e.getAllBlogs,u=Object(r.useState)(1),i=Object(h.a)(u,2),l=i[0],s=i[1];return!0===c?a.a.createElement("div",null,a.a.createElement(he.a,{horizontal:!0},"end")):a.a.createElement("div",null,a.a.createElement(E.a,{id:"loadMoreButton",color:"blue",onClick:function(){s(l+1),t?n(t,l):o(l)}},"Click to load more"))},Ie={getBlogsByUser:function(e,t){return function(){var n=Object(p.a)(m.a.mark((function n(r){var a;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,ne.getBlogsByUser(e,t);case 2:a=n.sent,r({type:"GET_BLOGS_BY_USER",allNumber:a.data.allNumber,blogList:a.data.blogList});case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},getUserInfo:function(e){return function(){var t=Object(p.a)(m.a.mark((function t(n){var r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,U.getUserInfo(e);case 2:r=t.sent,n({type:"GET_USER_INFO",checkedUser:r.data});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},clearBlogList:oe},Se=Object(u.b)((function(e){return{user:e.user,blog:e.blog,users:e.users}}),Ie)((function(e){var t=e.userId,n=e.isMe,c=function(){var n=Object(p.a)(m.a.mark((function n(){return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.getBlogsByUser(t,0);case 2:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),o=function(){var n=Object(p.a)(m.a.mark((function n(){return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.getUserInfo(t);case 2:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return Object(r.useEffect)((function(){return c(),o(),function(){return e.clearBlogList()}}),[t]),e.blog.blogList?a.a.createElement("div",null,a.a.createElement("div",{style:{float:"left",width:"100%",marginRight:"-300px"}},0===e.blog.blogList.length?a.a.createElement("div",null,"No blog",a.a.createElement(he.a,null)):a.a.createElement(Ne,{blogList:e.blog.blogList}),a.a.createElement(ke,{noMore:e.blog.blogList.length===e.blog.allNumber,userId:e.users.id,getBlogsByUser:e.getBlogsByUser})),a.a.createElement("div",{style:{float:"right"}},a.a.createElement("div",null," ",a.a.createElement("span",null,a.a.createElement($.a,{src:e.users.picture,verticalAlign:"middle",size:"tiny"}),a.a.createElement("h2",{style:{display:"inline"}},n?a.a.createElement("span",null,"Me"):a.a.createElement("span",null,e.users.userName)))))):null})),Ue=Object(u.b)((function(e){return{user:e.user}}))((function(e){return e.user.token?a.a.createElement(l.a,{to:"/home"}):a.a.createElement("h1",null,"Welcome to our Microblog Platform!")})),Le={getAllBlogs:function(e){return function(){var t=Object(p.a)(m.a.mark((function t(n){var r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ne.getAllBlogs(e);case 2:r=t.sent,n({type:"GET_ALL_BLOGS",allNumber:r.data.allNumber,blogList:r.data.blogList});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},clearBlogList:oe},Be=Object(u.b)((function(e){return{user:e.user,blog:e.blog,users:e.users}}),Le)((function(e){var t=function(){var t=Object(p.a)(m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getAllBlogs(0);case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(r.useEffect)((function(){return t(),function(){return e.clearBlogList()}}),[]),e.blog.blogList?a.a.createElement("div",{style:{float:"left",width:"100%",marginRight:"-300px"}},0===e.blog.blogList.length?a.a.createElement("div",null,"No blog",a.a.createElement(he.a,null)):a.a.createElement(Ne,{blogList:e.blog.blogList}),a.a.createElement(ke,{noMore:e.blog.blogList.length===e.blog.allNumber,getAllBlogs:e.getAllBlogs})):null})),Ae={initUser:function(){return function(){var e=Object(p.a)(m.a.mark((function e(t){var n,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=window.localStorage.getItem(A))&&(r=JSON.parse(n),k.setToken(r.token),t({type:"SET_USER",loggedInUser:r}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}},Re=Object(u.b)((function(e){return{user:e.user}}),Ae)((function(e){return Object(r.useEffect)((function(){e.initUser()}),[]),a.a.createElement("div",{className:"App",style:{textAlign:"left"}},a.a.createElement(X,null),a.a.createElement(i.a,null,a.a.createElement(be,null),a.a.createElement(l.d,null,a.a.createElement(me,{path:"/home",component:le}),a.a.createElement(me,{path:"/profile/:userId/:pageIndex",component:function(t){var n=t.match;return a.a.createElement(Se,{userId:n.params.userId,isMe:e.user.id===Number(n.params.userId)})}}),a.a.createElement(me,{path:"/setting",component:ve}),a.a.createElement(me,{path:"/discover",component:Be}),a.a.createElement(l.b,{exact:!0,path:"/",render:function(){return a.a.createElement(Ue,null)}}),a.a.createElement(l.b,{path:"/login",render:function(e){return a.a.createElement("div",null,a.a.createElement(G,{history:e}))}}),a.a.createElement(l.b,{path:"/register",render:function(e){return a.a.createElement("div",null,a.a.createElement(W,{history:e}))}}),a.a.createElement(l.b,{component:pe}))))})),Ce=(n(450),n(69)),Pe=n(252),Te=n(253),_e=n(254),Fe=n.n(_e),De=Object(Ce.combineReducers)({user:_,notification:D,blog:ue,users:Oe}),Me=Object(Ce.createStore)(De,Object(Te.composeWithDevTools)(Object(Ce.applyMiddleware)(Pe.a,(function(e){return function(t){return function(n){var r=localStorage.getItem(A)&&JSON.parse(localStorage.getItem(A))&&JSON.parse(localStorage.getItem(A)).token;r&&Fe()(r).exp<Date.now()/1e3&&(window.alert("Your session expired, please login again"),e.dispatch(T())),t(n)}}}))));o.a.render(a.a.createElement(u.a,{store:Me},a.a.createElement(Re,null)),document.getElementById("root"))}},[[263,1,2]]]);
//# sourceMappingURL=main.5f8ca54b.chunk.js.map