(this.webpackJsonpmicroblog_frontend=this.webpackJsonpmicroblog_frontend||[]).push([[0],{202:function(e,t,n){e.exports=n(349)},211:function(e,t,n){},349:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(40),o=n.n(c),i=n(26),u=n(42),s=n(48),l=(n(211),n(15)),m=n.n(l),f=n(20),p=n(361),d=n(362),g=n(357),E=n(363),v=n(360),h=n(359),b=n(62),x=function(e){var t=Object(r.useState)(""),n=Object(b.a)(t,2),a=n[0],c=n[1];return{type:e,value:a,onChange:function(e){c(e.target.value)}}},w=n(91),O=n.n(w),N={checkUserNameExisted:function(){var e=Object(f.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.a.post("".concat("/api/user","/isExist"),{userName:t});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),register:function(){var e=Object(f.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.a.post("".concat("/api/user","/register"),t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),login:function(){var e=Object(f.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.a.post("".concat("/api/user","/login"),t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},y=function(e){"bearer ".concat(e)},j="loggedInUser",I={userNameExisted:!1},k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"REGISTER":return I;case"USERNAME_EXISTED":return{userNameExisted:t.userNameExisted};case"SET_USER":return t.loggedInUser;case"CLEAR_USER":return null;default:return e}},S=function(e){var t=e.message,n=e.error,r={message:t,error:void 0!==n&&n};return function(){var e=Object(f.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t({type:"SET_NOTIFICATION",content:r}),setTimeout((function(){t({type:"CLEAR_NOTIFICATION"})}),5e3);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},U=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_NOTIFICATION":return t.content;case"CLEAR_NOTIFICATION":return{};default:return e}},T={login:function(e){return function(){var t=Object(f.a)(m.a.mark((function t(n){var r,a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,N.login(e);case 2:r=t.sent,a=r.data,window.localStorage.setItem(j,JSON.stringify(a)),y(a.token),n({type:"SET_USER",loggedInUser:a});case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},setNotification:S},R=Object(s.g)(Object(i.b)((function(e){return{user:e.user}}),T)((function(e){var t=x("text"),n=x("password"),r=0===t.value.length||0===n.value.length,c=function(){var r=Object(f.a)(m.a.mark((function r(a){var c;return m.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a.preventDefault(),c={userName:t.value,password:n.value},r.prev=2,r.next=5,e.login(c);case 5:r.next=10;break;case 7:r.prev=7,r.t0=r.catch(2),e.setNotification({message:"Login failed, wrong username or password",error:!0});case 10:case"end":return r.stop()}}),r,null,[[2,7]])})));return function(e){return r.apply(this,arguments)}}(),o=(e.location.state||{from:{pathname:"/home"}}).from;return e.user.token?(e.setNotification({message:"You have logged in",error:!1}),a.a.createElement("div",{className:"redirect"},a.a.createElement(s.a,{to:o}))):a.a.createElement("div",null,a.a.createElement(p.a,{textAlign:"center",style:{height:"100vh"},verticalAlign:"middle"},a.a.createElement(p.a.Column,{style:{maxWidth:450}},a.a.createElement(d.a,{as:"h2",color:"teal",textAlign:"center"},"Log in to your account"),a.a.createElement(g.a,{size:"large",onSubmit:c},a.a.createElement(E.a,{stacked:!0},a.a.createElement(g.a.Input,Object.assign({className:"userName",fluid:!0,icon:"user",iconPosition:"left",placeholder:"User Name"},t,{required:!0})),a.a.createElement(g.a.Input,Object.assign({className:"pwd",fluid:!0,icon:"lock",placeholder:"Password"},n,{required:!0})),a.a.createElement(v.a,{type:"submit",color:"teal",fluid:!0,size:"large",disabled:r},"Login"))),a.a.createElement(h.a,null,"New to us? ",a.a.createElement(u.b,{to:"/register"},"Sign Up")))))}))),A=n(90),C=function(e){var t=e.fieldName,n=e.input,r=e.minLength,c=e.maxLength,o=e.extraRequirement,i=e.extraErrorMessage;return n?r&&c&&(n.length<r||n.length>c)?a.a.createElement("p",{style:{color:"red"}},t," should be between ",r," and ",c," characters"):!1===o?a.a.createElement("p",{style:{color:"red"}},i):a.a.createElement("p",{style:{color:"green"}},"Valid ",t):null},L=function(){return a.a.createElement("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%,-50%)"}},a.a.createElement("h3",null,"You have already logged in, please go to the",a.a.createElement(u.b,{to:"/home"}," main page")," directly"))},_={checkUserNameExisted:function(e){return function(){var t=Object(f.a)(m.a.mark((function t(n){var r,a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,N.checkUserNameExisted(e);case 2:r=t.sent,a=!!r.data,n({type:"USERNAME_EXISTED",userNameExisted:a});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},register:function(e){return function(){var t=Object(f.a)(m.a.mark((function t(n){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,N.register(e);case 2:n({type:"REGISTER"});case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},setNotification:S},P=Object(s.g)(Object(i.b)((function(e){return{user:e.user}}),_)((function(e){var t=Object(r.useState)(!1),n=Object(b.a)(t,2),c=n[0],o=n[1],i=x("text"),l=x("password"),w=x("password"),O=function(e,t){var n=Object(r.useState)(e),a=Object(b.a)(n,2),c=a[0],o=a[1];return Object(r.useEffect)((function(){var n=setTimeout((function(){o(e)}),t);return function(){clearTimeout(n)}}),[e,t]),c}(i.value,500);Object(r.useEffect)((function(){O&&function(){var t=Object(f.a)(m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.checkUserNameExisted(O);case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()()}),[O]);var N=e.user.userNameExisted||i.value.length<3||i.value.length>255||l.value.length<3||l.value.length>255||l.value!==w.value,y=function(){var t=Object(f.a)(m.a.mark((function t(n){var r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),r={userName:i.value,password:w.value},t.prev=2,t.next=5,e.register(r);case 5:o(!0),e.setNotification({message:"Register succeeded, please log in",error:!1}),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),e.setNotification({message:"Register failed",error:!0});case 12:case"end":return t.stop()}}),t,null,[[2,9]])})));return function(e){return t.apply(this,arguments)}}();return c?a.a.createElement("div",{className:"redirect"},a.a.createElement(s.a,{to:"/login"})):e.user.token?a.a.createElement(L,null):a.a.createElement("div",null,a.a.createElement(p.a,{textAlign:"center",style:{height:"100vh"},verticalAlign:"middle"},a.a.createElement(p.a.Column,{style:{maxWidth:450}},a.a.createElement(d.a,{as:"h2",color:"teal",textAlign:"center"},"Sign Up"),a.a.createElement(g.a,{size:"large",onSubmit:y},a.a.createElement(E.a,{stacked:!0},a.a.createElement(g.a.Input,Object.assign({className:"userName",fluid:!0,icon:"user",iconPosition:"left",placeholder:"Username (between 3 and 255 characters)"},i,{required:!0})),a.a.createElement(C,{fieldName:"Username",input:i.value,minLength:3,maxLength:255,extraRequirement:!e.user.userNameExisted,extraErrorMessage:"User name is already existed"}),a.a.createElement(g.a.Input,Object.assign({className:"pwd",fluid:!0,icon:"lock",iconPosition:"left",placeholder:"Password (between 3 and 255 characters)"},l,{required:!0})),a.a.createElement(C,{fieldName:"Password",input:l.value,minLength:3,maxLength:255}),a.a.createElement(g.a.Input,Object.assign({className:"pwdConfirm",fluid:!0,placeholder:"Confirm Your Password"},w,{required:!0})),a.a.createElement(C,{fieldName:"Password confirmation",input:w.value,extraRequirement:l.value===w.value,extraErrorMessage:"Confirmation does not match the password"}),a.a.createElement(A.a,null,"Upload Your Head Portrait"),a.a.createElement(g.a.Input,{type:"file"}),a.a.createElement(v.a,{color:"teal",fluid:!0,size:"large",disabled:N},"Sign Up"))),a.a.createElement(h.a,null,"Already have an account? ",a.a.createElement(u.b,{to:"/login"},"Back to login")))))}))),q=n(364),z=Object(i.b)((function(e){return{notification:e.notification}}))((function(e){var t=e.notification,n=t.message,r=t.error;return n?a.a.createElement(q.a,{visible:!!n,animation:"fly down",duration:250},a.a.createElement("div",{style:{position:"fixed !important",top:"32px",right:"0",left:"0",textAlign:"center",zIndex:"10000"}},r?a.a.createElement(h.a,{floating:!0,color:"red",size:"large"},n):a.a.createElement(h.a,{floating:!0,color:"green",size:"large"},n))):null})),M=function(){return a.a.createElement("div",null,"Welcom to microblog")},D=n(190),F=Object(s.g)(Object(i.b)((function(e){return{user:e.user}}))((function(e){var t=!!e.user.token,n=e.component,r=Object(D.a)(e,["component"]);return a.a.createElement(s.b,Object.assign({},r,{render:function(e){return t?a.a.createElement(n,e):a.a.createElement(s.a,{to:{pathname:"/login",state:{from:e.location}}})}}))}))),J=function(){return a.a.createElement("div",null,"The page cannot be found...")},W={initUser:function(){return function(){var e=Object(f.a)(m.a.mark((function e(t){var n,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=window.localStorage.getItem(j))&&(r=JSON.parse(n),t({type:"SET_USER",loggedInUser:r}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}},Y=Object(i.b)((function(e){return{user:e.user}}),W)((function(e){return Object(r.useEffect)((function(){console.log("init"),e.initUser()}),[]),a.a.createElement("div",{className:"App"},a.a.createElement(z,null),a.a.createElement(u.a,null,a.a.createElement(s.d,null,a.a.createElement(F,{path:"/home",component:M}),a.a.createElement(s.b,{path:"/login",render:function(e){return a.a.createElement("div",null,a.a.createElement(R,{history:e}))}}),a.a.createElement(s.b,{path:"/register",render:function(e){return a.a.createElement("div",null,a.a.createElement(P,{history:e}))}}),a.a.createElement(s.b,{component:J}))))})),B=(n(348),n(54)),G=n(191),X=n(192),H=Object(B.combineReducers)({user:k,notification:U}),V=Object(B.createStore)(H,Object(X.composeWithDevTools)(Object(B.applyMiddleware)(G.a)));o.a.render(a.a.createElement(i.a,{store:V},a.a.createElement(Y,null)),document.getElementById("root"))}},[[202,1,2]]]);
//# sourceMappingURL=main.0f21e27f.chunk.js.map