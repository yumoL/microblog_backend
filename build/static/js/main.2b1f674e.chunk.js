(this.webpackJsonpmicroblog_frontend=this.webpackJsonpmicroblog_frontend||[]).push([[0],{206:function(e,t,a){e.exports=a(362)},215:function(e,t,a){},362:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(43),o=a.n(c),i=a(22),u=a(21),s=a(50),l=(a(215),a(9)),m=a.n(l),p=a(16),f=a(376),d=a(377),g=a(370),v=a(378),h=a(375),E=a(373),b=a(30),w=function(e,t){var a=Object(n.useState)(t||""),r=Object(b.a)(a,2),c=r[0],o=r[1];return{type:e,value:c,onChange:function(e){o(e.target.value)},clear:function(){o("")}}},x=a(37),O=a(51),y=a.n(O),j=null,N=function(){return{headers:{Authorization:j}}},k=function(e){j="bearer ".concat(e)},I=function(){j=null},S={checkUserNameExisted:function(){var e=Object(p.a)(m.a.mark((function e(t){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.post("".concat("/api/user","/isExist"),{userName:t});case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),register:function(){var e=Object(p.a)(m.a.mark((function e(t){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.post("".concat("/api/user","/register"),t);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),login:function(){var e=Object(p.a)(m.a.mark((function e(t){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.post("".concat("/api/user","/login"),t);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),changeBasicInfo:function(){var e=Object(p.a)(m.a.mark((function e(t,a){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.patch("".concat("/api/user","/changeInfo/").concat(t),a,N());case 2:return n=e.sent,console.log("returnUser",n.data),e.abrupt("return",n.data);case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),changePwd:function(){var e=Object(p.a)(m.a.mark((function e(t,a){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.patch("".concat("/api/user","/changePwd/").concat(t),a,N());case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},U={uploadFile:function(){var e=Object(p.a)(m.a.mark((function e(t){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.post("".concat("/api/utils","/upload"),t,N());case 2:return a=e.sent,console.log("return",a.data),e.abrupt("return",a.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()};function A(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function P(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?A(Object(a),!0).forEach((function(t){Object(x.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):A(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var R="loggedInUser",C={userNameExisted:!1},T=function(e){window.localStorage.setItem(R,JSON.stringify(e)),k(e.token)},L=function(e){return function(){var t=Object(p.a)(m.a.mark((function t(a){var n,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,S.checkUserNameExisted(e);case 2:n=t.sent,r=!!n.data,a({type:"USERNAME_EXISTED",userNameExisted:r});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},F=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"REGISTER":return C;case"USERNAME_EXISTED":return P({},e,{userNameExisted:t.userNameExisted});case"SET_USER":return t.loggedInUser;case"CLEAR_USER":return C;case"UPDATE_USER_INFO":return t.updatedUser;default:return e}},_=function(e){var t=e.message,a=e.error,n={message:t,error:void 0!==a&&a};return function(){var e=Object(p.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t({type:"SET_NOTIFICATION",content:n}),setTimeout((function(){t({type:"CLEAR_NOTIFICATION"})}),5e3);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},D=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_NOTIFICATION":return t.content;case"CLEAR_NOTIFICATION":return{};default:return e}},M={login:function(e){return function(){var t=Object(p.a)(m.a.mark((function t(a){var n,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,S.login(e);case 2:n=t.sent,r=n.data,T(r),a({type:"SET_USER",loggedInUser:r});case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},setNotification:_},z=Object(s.g)(Object(i.b)((function(e){return{user:e.user}}),M)((function(e){var t=w("text"),a=w("password"),n=0===t.value.length||0===a.value.length,c=function(){var n=Object(p.a)(m.a.mark((function n(r){var c;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r.preventDefault(),c={userName:t.value,password:a.value},n.prev=2,n.next=5,e.login(c);case 5:n.next=10;break;case 7:n.prev=7,n.t0=n.catch(2),e.setNotification({message:"Login failed, wrong username or password",error:!0});case 10:case"end":return n.stop()}}),n,null,[[2,7]])})));return function(e){return n.apply(this,arguments)}}(),o=(e.location.state||{from:{pathname:"/home"}}).from;return e.user.token?(e.setNotification({message:"You have logged in",error:!1}),r.a.createElement("div",{className:"redirect"},r.a.createElement(s.a,{to:o}))):r.a.createElement("div",null,r.a.createElement(f.a,{textAlign:"center",style:{height:"100vh"},verticalAlign:"middle"},r.a.createElement(f.a.Column,{style:{maxWidth:450}},r.a.createElement(d.a,{as:"h2",color:"teal",textAlign:"center"},"Log in to your account"),r.a.createElement(g.a,{size:"large",onSubmit:c},r.a.createElement(v.a,{stacked:!0},r.a.createElement(g.a.Input,Object.assign({className:"userName",fluid:!0,icon:"user",iconPosition:"left",placeholder:"User Name"},t,{required:!0})),r.a.createElement(g.a.Input,Object.assign({className:"pwd",fluid:!0,icon:"lock",placeholder:"Password"},a,{required:!0})),r.a.createElement(h.a,{type:"submit",color:"teal",fluid:!0,size:"large",disabled:n},"Login"))),r.a.createElement(E.a,null,"New to us? ",r.a.createElement(u.b,{to:"/register"},"Sign Up")))))}))),q=function(e,t){var a=Object(n.useState)(e),r=Object(b.a)(a,2),c=r[0],o=r[1];return Object(n.useEffect)((function(){var a=setTimeout((function(){o(e)}),t);return function(){clearTimeout(a)}}),[e,t]),c},B=function(e){var t=e.fieldName,a=e.input,n=e.minLength,c=e.maxLength,o=e.extraRequirement,i=e.extraErrorMessage;return a?n&&c&&(a.length<n||a.length>c)?r.a.createElement("p",{style:{color:"red"}},t," should be between ",n," and ",c," characters"):!1===o?r.a.createElement("p",{style:{color:"red"}},i):r.a.createElement("p",{style:{color:"green"}},"Valid ",t):null},W=function(){return r.a.createElement("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%,-50%)"}},r.a.createElement("h3",null,"You have already logged in, please go to the",r.a.createElement(u.b,{to:"/home"}," main page")," directly"))},Y={checkUserNameExisted:L,register:function(e){return function(){var t=Object(p.a)(m.a.mark((function t(a){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,S.register(e);case 2:a({type:"REGISTER"});case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},setNotification:_,uploadFile:function(e){return function(){var t=Object(p.a)(m.a.mark((function t(a){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,U.uploadFile(e);case 2:n=t.sent,a({type:"UPLOAD",url:n.data});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}},J=Object(s.g)(Object(i.b)((function(e){return{user:e.user,file:e.file}}),Y)((function(e){var t=Object(n.useState)(!1),a=Object(b.a)(t,2),c=a[0],o=a[1],i=w("text"),l=w("password"),x=w("password"),O=q(i.value,500);Object(n.useEffect)((function(){O&&function(){var t=Object(p.a)(m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.checkUserNameExisted(O);case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()()}),[O]);var y=e.user.userNameExisted||i.value.length<3||i.value.length>255||l.value.length<3||l.value.length>255||l.value!==x.value,j=function(){var t=Object(p.a)(m.a.mark((function t(a){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.preventDefault(),n={userName:i.value,password:x.value},t.prev=2,t.next=5,e.register(n);case 5:o(!0),e.setNotification({message:"Register succeeded, please log in",error:!1}),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),e.setNotification({message:"Register failed",error:!0});case 12:case"end":return t.stop()}}),t,null,[[2,9]])})));return function(e){return t.apply(this,arguments)}}();return c?r.a.createElement("div",{className:"redirect"},r.a.createElement(s.a,{to:"/login"})):e.user.token?r.a.createElement(W,null):r.a.createElement("div",null,r.a.createElement(f.a,{textAlign:"center",style:{height:"100vh"},verticalAlign:"middle"},r.a.createElement(f.a.Column,{style:{maxWidth:450}},r.a.createElement(d.a,{as:"h2",color:"teal",textAlign:"center"},"Sign Up"),r.a.createElement(g.a,{size:"large",onSubmit:j},r.a.createElement(v.a,{stacked:!0},r.a.createElement(g.a.Input,Object.assign({className:"userName",fluid:!0,icon:"user",iconPosition:"left",placeholder:"Username (between 3 and 255 characters)"},i,{required:!0})),r.a.createElement(B,{fieldName:"Username",input:i.value,minLength:3,maxLength:255,extraRequirement:!e.user.userNameExisted,extraErrorMessage:"User name is already existed"}),r.a.createElement(g.a.Input,Object.assign({className:"pwd",fluid:!0,icon:"lock",iconPosition:"left",placeholder:"Password (between 3 and 255 characters)"},l,{required:!0})),r.a.createElement(B,{fieldName:"Password",input:l.value,minLength:3,maxLength:255}),r.a.createElement(g.a.Input,Object.assign({className:"pwdConfirm",fluid:!0,placeholder:"Confirm Your Password"},x,{required:!0})),r.a.createElement(B,{fieldName:"Password confirmation",input:x.value,extraRequirement:l.value===x.value,extraErrorMessage:"Confirmation does not match the password"}),r.a.createElement(h.a,{color:"teal",fluid:!0,size:"large",disabled:y},"Sign Up"))),r.a.createElement(E.a,null,"Already have an account? ",r.a.createElement(u.b,{to:"/login"},"Back to login")))))}))),H=a(379),G=Object(i.b)((function(e){return{notification:e.notification}}))((function(e){var t=e.notification,a=t.message,n=t.error;return a?r.a.createElement(H.a,{visible:!!a,animation:"fly down",duration:250},r.a.createElement("div",{style:{position:"fixed !important",top:"32px",right:"0",left:"0",textAlign:"center",zIndex:"10000"}},n?r.a.createElement(E.a,{floating:!0,color:"red",size:"large"},a):r.a.createElement(E.a,{floating:!0,color:"green",size:"large"},a))):null})),X=function(){return r.a.createElement("div",null,"Welcom to microblog")},V=a(193),K=Object(s.g)(Object(i.b)((function(e){return{user:e.user}}))((function(e){var t=!!e.user.token,a=e.component,n=Object(V.a)(e,["component"]);return r.a.createElement(s.b,Object.assign({},n,{render:function(e){return t?r.a.createElement(a,e):r.a.createElement(s.a,{to:{pathname:"/login",state:{from:e.location}}})}}))}))),Q=function(){return r.a.createElement("div",null,"The page cannot be found...")},Z=a(374),$=a(372),ee={logout:function(){return function(){var e=Object(p.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:I(),window.localStorage.removeItem(R),t({type:"CLEAR_USER"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}},te=Object(i.b)((function(e){return{user:e.user}}),ee)((function(e){var t=Object(n.useState)(e.user.token?"Home":"Login"),a=Object(b.a)(t,2),c=a[0],o=a[1],i=function(e,t){var a=t.name;o(a)};return e.user.token?r.a.createElement(Z.a,{tabular:!0},r.a.createElement(Z.a.Item,{name:"Home",active:"Home"===c,onClick:i,as:u.b,to:"/home"}),r.a.createElement(Z.a.Item,{name:"My blogs",active:"My blogs"===c,onClick:i,as:u.b,to:"/myblogs"}),r.a.createElement(Z.a.Item,{name:"Discover",active:"Discover"===c,onClick:i,as:u.b,to:"/discover"}),r.a.createElement(Z.a.Menu,{position:"right"},r.a.createElement($.a,{item:!0,text:"Setting"},r.a.createElement($.a.Menu,null,r.a.createElement($.a.Item,{as:u.b,to:"/setting"},"Account setting"),r.a.createElement($.a.Item,null,r.a.createElement(h.a,{onClick:e.logout},r.a.createElement(u.b,{to:"/login"},"Logout"))))))):r.a.createElement(Z.a,{tabular:!0},r.a.createElement(Z.a.Item,{name:"Login",active:"Login"===c,onClick:i,as:u.b,to:"/login"}),r.a.createElement(Z.a.Item,{name:"Register",active:"Register"===c,onClick:i,as:u.b,to:"/register"}))})),ae=a(197),ne={checkUserNameExisted:L,changeBasicInfo:function(e,t,a){return function(){var n=Object(p.a)(m.a.mark((function n(r){var c,o,i,u,s;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(c={newUserName:t},null===a){n.next=7;break}return n.next=4,U.uploadFile(a);case 4:o=n.sent,i=o.data.url,c=P({},c,{newPicture:i});case 7:return n.next=9,S.changeBasicInfo(e,c);case 9:u=n.sent,s=u.data,T(s),r({type:"UPDATE_USER_INFO",updatedUser:s});case 13:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},changePwd:function(e,t,a){return function(){var n=Object(p.a)(m.a.mark((function n(r){var c,o,i;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return c={pwd:t,newPwd:a},n.next=3,S.changePwd(e,c);case 3:o=n.sent,i=o.data,T(i),r({type:"UPDATE_USER_INFO",updatedUser:i});case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},setNotification:_},re=Object(i.b)((function(e){return{user:e.user}}),ne)((function(e){var t=w("text",e.user.userName),a=q(t.value,500),c=w("password"),o=w("password"),i=w("password"),u=Object(n.useState)(null),s=Object(b.a)(u,2),l=s[0],v=s[1],E=Object(n.useState)(""),x=Object(b.a)(E,2),O=x[0],y=x[1];Object(n.useEffect)((function(){a&&function(){var t=Object(p.a)(m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.checkUserNameExisted(a);case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()()}),[a]);var j=function(){var a=Object(p.a)(m.a.mark((function a(n){var r;return m.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n.preventDefault(),r=null,null!==l&&(r=new FormData).append("file",l),a.prev=3,a.next=6,e.changeBasicInfo(e.user.id,t.value,r);case 6:e.setNotification({message:"You have changed your basic information",error:!1}),a.next=12;break;case 9:a.prev=9,a.t0=a.catch(3),e.setNotification({message:"Fail to change basic information",error:!0});case 12:case"end":return a.stop()}}),a,null,[[3,9]])})));return function(e){return a.apply(this,arguments)}}(),N=function(){var t=Object(p.a)(m.a.mark((function t(a){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.preventDefault(),t.prev=1,t.next=4,e.changePwd(e.user.id,c.value,o.value);case 4:e.setNotification({message:"You have changed your password",error:!1}),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),e.setNotification({message:"Fail to change password, please make sure that your old password is correct",error:!0});case 10:c.clear(),o.clear(),i.clear();case 13:case"end":return t.stop()}}),t,null,[[1,7]])})));return function(e){return t.apply(this,arguments)}}(),k=e.user.userNameExisted&&t.value!==e.user.userName||t.value.length<3||t.value.length>255,I=o.value.length<3||o.value.length>255||o.value!==i.value;return r.a.createElement(f.a,{textAlign:"center",style:{height:"100vh"},verticalAlign:"middle"},r.a.createElement(f.a.Column,{style:{maxWidth:450}},r.a.createElement(d.a,{as:"h2",color:"teal",textAlign:"center"},"Account Setting"),r.a.createElement(d.a,{as:"h3",color:"teal",textAlign:"center"},"Basic information"),r.a.createElement(g.a,{onSubmit:j},r.a.createElement(g.a.Field,null,r.a.createElement("label",null,"User name"),r.a.createElement("input",t),r.a.createElement(B,{fieldName:"Username",input:t.value,minLength:3,maxLength:255,extraRequirement:!e.user.userNameExisted||t.value===e.user.userName,extraErrorMessage:"User name is already existed"})),r.a.createElement(g.a.Field,null,r.a.createElement("label",null,"Change head portrait"),r.a.createElement(g.a.Input,{type:"file",accept:"image/*",onChange:function(e){var t=e.target.files[0];v(t),y(URL.createObjectURL(t))}}),r.a.createElement(ae.a,{src:""!==O?O:e.user.picture,size:"small"})),r.a.createElement(h.a,{color:"teal",fluid:!0,size:"large",disabled:k},"Save basic information changes")),r.a.createElement(d.a,{as:"h3",color:"teal",textAlign:"center"},"Password"),r.a.createElement(g.a,{onSubmit:N},r.a.createElement(g.a.Field,null,r.a.createElement("label",null,"Current password"),r.a.createElement("input",Object.assign({placeholder:"current password"},c))),r.a.createElement(g.a.Field,null,r.a.createElement("label",null,"New password"),r.a.createElement("input",Object.assign({placeholder:"new password"},o)),r.a.createElement(B,{fieldName:"Password",input:o.value,minLength:3,maxLength:255})),r.a.createElement(g.a.Field,null,r.a.createElement("label",null,"Confirm new password"),r.a.createElement("input",Object.assign({placeholder:"new password confirmation"},i))),r.a.createElement(B,{fieldName:"Password confirmation",input:i.value,extraRequirement:o.value===i.value,extraErrorMessage:"Confirmation does not match the password"}),r.a.createElement(h.a,{color:"teal",fluid:!0,size:"large",disabled:I},"Save new password"))))})),ce={initUser:function(){return function(){var e=Object(p.a)(m.a.mark((function e(t){var a,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(a=window.localStorage.getItem(R))&&(n=JSON.parse(a),k(n.token),t({type:"SET_USER",loggedInUser:n}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}},oe=Object(i.b)((function(e){return{user:e.user}}),ce)((function(e){return Object(n.useEffect)((function(){console.log("init"),e.initUser()}),[]),r.a.createElement("div",{className:"App"},r.a.createElement(G,null),r.a.createElement(u.a,null,r.a.createElement(te,null),r.a.createElement(s.d,null,r.a.createElement(K,{path:"/home",component:X}),r.a.createElement(K,{path:"/setting",component:re}),r.a.createElement(s.b,{path:"/login",render:function(e){return r.a.createElement("div",null,r.a.createElement(z,{history:e}))}}),r.a.createElement(s.b,{path:"/register",render:function(e){return r.a.createElement("div",null,r.a.createElement(J,{history:e}))}}),r.a.createElement(s.b,{component:Q}))))})),ie=(a(361),a(57)),ue=a(195),se=a(196),le=Object(ie.combineReducers)({user:F,notification:D}),me=Object(ie.createStore)(le,Object(se.composeWithDevTools)(Object(ie.applyMiddleware)(ue.a)));o.a.render(r.a.createElement(i.a,{store:me},r.a.createElement(oe,null)),document.getElementById("root"))}},[[206,1,2]]]);
//# sourceMappingURL=main.2b1f674e.chunk.js.map